# Домашнее задание к занятию 1. «Типы и структура СУБД» - Иванов Дмитрий (fops-13)

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определённых данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- электронные чеки в json-виде,
- склады и автомобильные дороги для логистической компании,
- генеалогические деревья,
- кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации,
- отношения клиент-покупка для интернет-магазина.

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

### Решение задания 1

`электронные чеки в json-виде`
> Подойдут документоориентированные БД (NoSQL), к примеру MongoDB. Такого рода БД хорошо подходят для хранения документоориентированных данных, так как JSON обладает гибкой структурой и может быть легко хранить и извлекать в БД без жесткой схемы.

`склады и автомобильные дороги для логистической компании`
> Подойдёт графовая БД, такая модель данных позволяет легко моделировать сложные связи и отношения между данными. В графовой базе данных можно представить любые типы объектов и их связи, что делает ее удобной для работы с различными типами данных. В нашем случае дороги - связи, склады - объекты. Но если вопрос рассмотреть под другим углом, а именно: наличие продукции на складе, её наименование, протяжённость маршрута доставки, точки доставки и тд, то возможно применение и реляционных БД.

`генеалогические деревья`
> Хочется назвать иерархическую БД, но будет дорого и громоздко, оптимальным вариантом можно посчитать использование графовой БД, так как они оптимизированы для работы с связями между объектами и могут легко представлять сложные отношения. 

`кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации`
> Однозначно это СУБД типа "ключ-значение", например Redis и Memcached. Их фишка при работе с кэшем и другими временными данными - это хранение всей информации в ОЗУ, а также возможность присваивать данным time-to-live (TTL), то есть задавать параметры жизненного цикла. 
> Redis - имеет более широкий функционал, а Memcached - более простотв в использовании, но в данном случае можно остановиться на Redis, так как redis умеет удалять ключи с истёкшим TTL.

`отношения клиент-покупка для интернет-магазина`
> Реляционные БД хорошо подходят для хранения и обработки связей между объектами и обеспечивают надежность, целостность данных и возможность выполнения мощных запросов. В нашем случае это транзакции.


## Задача 2

Вы создали распределённое высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт — это отдельная реализация вашей системы и для каждого пункта нужно привести классификацию):

- данные записываются на все узлы с задержкой до часа (асинхронная запись);
- при сетевых сбоях система может разделиться на 2 раздельных кластера;
- система может не прислать корректный ответ или сбросить соединение.

Согласно PACELC-теореме как бы вы классифицировали эти реализации?


### Решение задания 2


```
1. AP
2. CA
3. CP
```

`данные записываются на все узлы с задержкой до часа (асинхронная запись)` 
> Данный пункт классифицируем как AP (система гарантирует устойчивость к разделению и доступность, так как данные пишутся на все узлы, но не гарантирует согласованность, так как присутствует задержка по времени между узлами);

`при сетевых сбоях система может разделиться на 2 раздельных кластера`
> классификацией 2 системы тонкий момент. Я бы отнесла ее к CA, так как если у нас произошёл развал на кластеры, то это точно не P. Такая ситуация получается, когда данные во всех узлах кластера согласованы и доступны, но не устойчивы к разделению. Это означает, что реплики одной и той же информации, распределенные по разным серверам друг другу, не противоречат друг другу и любой запрос к распределённой системе завершается корректным откликом.
> Стоит дополнить, что в этом пункте могут быть разночтения. Например, вполне возможно, что CAP-теорема тут может быть вообще не применима. Напомню, что в ней говорится лишь о максимально возможном количестве состояний (два из трёх), но это не отрицает отсутствия двух или всех трёх свойств.
`система может не прислать корректный ответ или сбросить соединение`
> CP-система (Consistency + Partition tolerance — Availability) в каждый момент обеспечивает целостность данных и способна работать в условиях распада в ущерб доступности, не выдавая отклик на запрос. 


## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

### Решение задания 3

Данные принципы взаимоисключают друг друга.

> ACID является традиционным подходом, где основной упор делается на согласованность данных и гарантии транзакционной целостности. 
> ACID-транзакции гарантируют атомарность, согласованность, изоляцию и долговечность данных. 
> Этот подход обычно используется в традиционных реляционных базах данных, где согласованность данных имеет высший приоритет над доступностью.

> BASE уделяет больший приоритет доступности и масштабируемости системы, жертвуя некоторой степенью согласованности данных. 
> BASE-системы стремятся обеспечить базовую доступность (basically available), мягкое состояние (soft state) и постепенную согласованность данных (eventually consistent). 
> Они обычно используются в распределенных системах, где высокая доступность и масштабируемость являются приоритетами, даже если некоторые узлы могут быть временно несогласованными.


## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни,
- реакция на истечение таймаута.

Вы слышали о key-value-хранилище, которое имеет механизм Pub/Sub. 
Что это за система? Какие минусы выбора этой системы?


### Решение задания 4

Такими особенностями обладает Redis.

Само хранилище (Key-value с механизмом Pub/Sub) - это система, которая предоставляет возможность хранить данные в виде пар ключ-значение и подписываться на определенные события.
Сам механизм Pub/Sub позволяет публиковать сообщения в каналы и подписываться на эти каналы для получения уведомлений о новых сообщениях.
Таким образом, при изменении значения ключа или при истечении таймаута можно публиковать соответствующие сообщения, на которые другие компоненты системы смогут подписаться и принять соответствующие действия.

Минусы/Риски:

БД не хранит у себя сообщения, они рассылаются потребителям и затем удаляются. Redis хранит данные в памяти и периодически делает снапшоты на жёсткий диск. 
Может получится так, что при отказе редиса какие-то данные могут не успеть записаться в снапшот и при восстановлении самого редиса эти данные не восстановятся, так мы и события можем потерять, и соответстующие уведомления в pub/sub.